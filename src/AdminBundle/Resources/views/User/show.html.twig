{% extends '@App/layout.html.twig' %}

{% block title %}Edit Users{% endblock %}

{% block content %}
    <h1>Список Виборців</h1>

    <table class="record_properties">
        <tbody>
            <tr>
                <th>Id</th>
                <td>{{ entity.id }}</td>
            </tr>
            <tr>
                <th>Ім'я</th>
                <td>{{ entity.firstName }}</td>
            </tr>
            <tr>
                <th>Прізвище</th>
                <td>{{ entity.lastName }}</td>
            </tr>
            <tr>
                <th>По батькові</th>
                <td>{{ entity.middleName }}</td>
            </tr>
            <tr>
                <th>Cтать</th>
                <td>{{ entity.sex }}</td>
            </tr>
            <tr>
                <th>Дата народження</th>
                <td>{{ entity.birthday }}</td>
            </tr>
            <tr>
                <th>Телефон</th>
                <td>{{ entity.phone }}</td>
            </tr>
            <tr>
                <th>e-mail</th>
                <td>{{ entity.email }}</td>
            </tr>
            <tr>
                <th>ІНН</th>
                <td>{{ entity.inn }}</td>
            </tr>
            <tr>
                <th>Номер бланку</th>
                <td>{{ entity.numberBlank }}</td>
            </tr>
            {% if entity.addedByAdmin %}
                <tr>
                    <th>Добавлено:</th>
                    <td>{{ entity.addedByAdmin.firstName }} {{ entity.addedByAdmin.lastName }}</td>
                </tr>
            {% endif %}
            <tr>
                <th>Createat</th>
                <td>{{ entity.createAt|date('Y-m-d H:i:s') }}</td>
            </tr>
        </tbody>
    </table>

    {{ render(controller('AppBundle:User:countVotes', {'id': entity.id})) }}

    <ul class="record_actions">
    <li>
        <a href="{{ path('admin_users') }}">
            Повернутися до списку виборців
        </a>
    </li>
    <li>
        <a href="{{ path('admin_users_edit', { 'id': entity.id }) }}">
            Редагувати
        </a>
    </li>

    {{ form_errors(delete_form) }}
    {{ form_start(delete_form, {'action': path('admin_users_delete', {'id': entity.id}), 'method': 'POST'}) }}


    <div class="margin-top-20 btn_save">
        {{ form_widget(delete_form.submit, {'attr': {'class': 'btn green-haze'}}) }}
    </div>
    {{ form_end(delete_form) }}
    </ul>

    {% for vote in balanceVotes %}
        <ul>
            <li>
                <a href="{{ vote['balance'] > 0 ? path('admin_user_new_paper_vote', {'user_id': entity.id, 'voting_id': vote[0].id}) : '#' }}">
                    {{ vote[0].title }} - {{ vote['balance'] }}
                </a>
            </li>
        </ul>
    {% endfor %}

    <div class="count">
        Список проектів: {{ pagination.getTotalItemCount }}
    </div>
    <table class="table table-striped">
        <tr>
            {# sorting of properties based on query components #}
            <th>{{ knp_pagination_sortable(pagination, 'Номер в системі', 'a.id') }}</th>
            <th{% if pagination.isSorted('a.title') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Назва проекту', 'a.title') }}</th>
            <th{% if pagination.isSorted('vs.title') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Голосування', 'vs.title') }}</th>
            <th>{{ knp_pagination_sortable(pagination, 'Створено', ['a.createAt']) }}</th>
            <th> Проголосувати </th>
        </tr>

        {# table body #}
        {% for article in pagination %}
            <tr {% if loop.index is odd %}class="color"{% endif %}>
                <td>{{ article.id }}</td>
                <td>{{ article.title }}</td>
                {% if article.voteSetting %}<td>{{ article.voteSetting.title }}</td>{% endif %}
                <td>{% if article.createAt %}{{ article.createAt|date('Y-m-d') }}{% endif %}</td>

                <td>
                    <ul>
                        <li>
                            <a href="{{ path('admin_projects_like', { 'id_project': article.id, 'id_user': entity.id}) }}">Віддати голос</a>
                        </li>
                    </ul>
                </td>
            </tr>
        {% endfor %}
    </table>

    <div class="navigation">
        {{ knp_pagination_render(pagination) }}
    </div>
{% endblock %}